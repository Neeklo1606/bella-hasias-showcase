import{c as P,r as x,e as J,f as Q,g as X,m as V,j as e,h as Z,i as ee,k as te,B as v,L as se,A as Y,n as ne,l as ae,o as re}from"./index-LVCzZBFt.js";import{D as F,a as T,b as A,c as R,e as _,L as S,I as E}from"./label-BsaR7ijS.js";import{C as le,b as ie,d as ce}from"./card-Cf70q5zp.js";import{F as oe}from"./file-text-BndFCzru.js";import{P as U,C as de,l as ue,T as me,S as he,a as xe,b as fe,c as pe,d as je}from"./alert-dialog-Dvt3fn7b.js";import{E as ge}from"./external-link-BeFWcwUf.js";import{f as we,r as ve}from"./ru-CVN3f-jD.js";import{T as B}from"./popover-DUnge7kd.js";import{M as ye}from"./MediaSelect-BEF3l7uE.js";import{P as K,C as Se}from"./ConfirmDialog-dz5BH-Ts.js";import{u as Ne}from"./use-resolved-media-BLl9ynrQ.js";import"./index-BnWSyGdw.js";import"./check-KzHrZiou.js";import"./image-BCfxMQnL.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=P("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=P("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=P("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),q=x.createContext(null);function Ee(t,r,l,u){if(!u)return t;const s=t.findIndex(n=>n.value===r);if(s===-1)return t;const c=u>0?1:-1,d=t[s+c];if(!d)return t;const m=t[s],i=d.layout,h=J(i.min,i.max,.5);return c===1&&m.layout.max+l>h||c===-1&&m.layout.min+l<h?Q(t,s,s+c):t}function Le({children:t,as:r="ul",axis:l="y",onReorder:u,values:s,...c},d){const m=X(()=>V[r]),i=[],h=x.useRef(!1),n=x.useRef(null),p={axis:l,groupRef:n,registerItem:(w,C)=>{const k=i.findIndex(j=>w===j.value);k!==-1?i[k].layout=C[l]:i.push({value:w,layout:C[l]}),i.sort(Oe)},updateOrder:(w,C,k)=>{if(h.current)return;const j=Ee(i,w,C,k);i!==j&&(h.current=!0,u(j.map(Me).filter(N=>s.indexOf(N)!==-1)))}};x.useEffect(()=>{h.current=!1});const y=w=>{n.current=w,typeof d=="function"?d(w):d&&(d.current=w)},g={overflowAnchor:"none",...c.style};return e.jsx(m,{...c,style:g,ref:y,ignoreStrict:!0,children:e.jsx(q.Provider,{value:p,children:t})})}const Ie=x.forwardRef(Le);function Me(t){return t.value}function Oe(t,r){return t.layout.min-r.layout.min}const D=50,$=25,De=new Set(["auto","scroll"]),I=new WeakMap,M=new WeakMap;let L=null;function Fe(){if(L){const t=z(L,"y");t&&(M.delete(t),I.delete(t));const r=z(L,"x");r&&r!==t&&(M.delete(r),I.delete(r)),L=null}}function Te(t,r){const l=getComputedStyle(t),u=r==="x"?l.overflowX:l.overflowY,s=t===document.body||t===document.documentElement;return De.has(u)||s}function z(t,r){let l=t==null?void 0:t.parentElement;for(;l;){if(Te(l,r))return l;l=l.parentElement}return null}function Ae(t,r,l){const u=r.getBoundingClientRect(),s=l==="x"?Math.max(0,u.left):Math.max(0,u.top),c=l==="x"?Math.min(window.innerWidth,u.right):Math.min(window.innerHeight,u.bottom),d=t-s,m=c-t;if(d<D){const i=1-d/D;return{amount:-$*i*i,edge:"start"}}else if(m<D){const i=1-m/D;return{amount:$*i*i,edge:"end"}}return{amount:0,edge:null}}function Re(t,r,l,u){if(!t)return;L=t;const s=z(t,l);if(!s)return;const c=r-(l==="x"?window.scrollX:window.scrollY),{amount:d,edge:m}=Ae(c,s,l);if(m===null){M.delete(s),I.delete(s);return}const i=M.get(s),h=s===document.body||s===document.documentElement;if(i!==m){if(!(m==="start"&&u<0||m==="end"&&u>0))return;M.set(s,m);const p=l==="x"?s.scrollWidth-(h?window.innerWidth:s.clientWidth):s.scrollHeight-(h?window.innerHeight:s.clientHeight);I.set(s,p)}if(d>0){const n=I.get(s);if((l==="x"?h?window.scrollX:s.scrollLeft:h?window.scrollY:s.scrollTop)>=n)return}l==="x"?h?window.scrollBy({left:d}):s.scrollLeft+=d:h?window.scrollBy({top:d}):s.scrollTop+=d}function H(t,r=0){return ee(t)?t:te(r)}function Be({children:t,style:r={},value:l,as:u="li",onDrag:s,onDragEnd:c,layout:d=!0,...m},i){const h=X(()=>V[u]),n=x.useContext(q),p={x:H(r.x),y:H(r.y)},y=Z([p.x,p.y],([j,N])=>j||N?1:"unset"),{axis:g,registerItem:w,updateOrder:C,groupRef:k}=n;return e.jsx(h,{drag:g,...m,dragSnapToOrigin:!0,style:{...r,x:p.x,y:p.y,zIndex:y},layout:d,onDrag:(j,N)=>{const{velocity:f,point:a}=N,o=p[g].get();C(l,o,f[g]),Re(k.current,a[g],g,f[g]),s&&s(j,N)},onDragEnd:(j,N)=>{Fe(),c&&c(j,N)},onLayoutMeasure:j=>{w(l,j)},ref:i,ignoreStrict:!0,children:t})}const ze=x.forwardRef(Be),Pe=({page:t,onEdit:r})=>{var s;const l=t.slug==="home"?"/":`/${t.slug}`,u=((s=t.blocks)==null?void 0:s.length)??0;return e.jsx(V.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.2},layout:!0,children:e.jsxs(le,{className:"overflow-hidden transition-shadow hover:shadow-md",children:[e.jsxs(ie,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"flex h-12 w-12 shrink-0 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(oe,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["/",t.slug," · ",u," блоков"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:["Обновлено:"," ",we(new Date(t.updatedAt),{addSuffix:!0,locale:ve})]})]})]}),e.jsxs(ce,{className:"flex gap-2 border-t p-4",children:[e.jsxs(v,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>r(t),children:[e.jsx(U,{className:"mr-1 h-3 w-3"}),"Редактировать"]}),e.jsx(v,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(se,{to:l,target:"_blank",children:e.jsx(ge,{className:"h-3 w-3"})})})]})]})})},W={hero:"Hero",text:"Текст (Markdown)",cta:"CTA-блок",services:"Услуги",portfolio:"Портфолио",contacts:"Контакты",custom:"Произвольный блок"},Ve=({open:t,onOpenChange:r,block:l,mediaItems:u,onSave:s})=>{const[c,d]=x.useState({});if(x.useEffect(()=>{l&&d({...l.data??{}})},[l,t]),!l)return null;const m=n=>{n.preventDefault(),s(c),r(!1)},i=(n,p)=>d(y=>({...y,[n]:p})),h=()=>{switch(l.type){case"hero":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"title",children:"Заголовок"}),e.jsx(E,{id:"title",value:String(c.title??""),onChange:n=>i("title",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"subtitle",children:"Подзаголовок"}),e.jsx(E,{id:"subtitle",value:String(c.subtitle??""),onChange:n=>i("subtitle",n.target.value)})]}),e.jsx(ye,{label:"Изображение",value:String(c.imageId??""),onChange:n=>i("imageId",n),items:u,allowEmpty:!0})]});case"text":case"custom":return e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"markdown",children:"Markdown"}),e.jsx(B,{id:"markdown",value:String(c.markdown??""),onChange:n=>i("markdown",n.target.value),rows:8,className:"font-mono text-sm"})]});case"cta":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"title",children:"Заголовок"}),e.jsx(E,{id:"title",value:String(c.title??""),onChange:n=>i("title",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"markdown",children:"Текст (Markdown)"}),e.jsx(B,{id:"markdown",value:String(c.markdown??""),onChange:n=>i("markdown",n.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"ctaLabel",children:"Подпись кнопки"}),e.jsx(E,{id:"ctaLabel",value:String(c.ctaLabel??""),onChange:n=>i("ctaLabel",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"ctaLink",children:"Ссылка"}),e.jsx(E,{id:"ctaLink",value:String(c.ctaLink??""),onChange:n=>i("ctaLink",n.target.value)})]})]});case"services":case"portfolio":case"contacts":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"title",children:"Заголовок"}),e.jsx(E,{id:"title",value:String(c.title??""),onChange:n=>i("title",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"subtitle",children:"Подзаголовок"}),e.jsx(E,{id:"subtitle",value:String(c.subtitle??""),onChange:n=>i("subtitle",n.target.value)})]})]});default:return e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"markdown",children:"Содержимое (Markdown)"}),e.jsx(B,{id:"markdown",value:String(c.markdown??""),onChange:n=>i("markdown",n.target.value),rows:6})]})}};return e.jsx(F,{open:t,onOpenChange:r,children:e.jsxs(T,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[500px]",children:[e.jsx(A,{children:e.jsx(R,{children:"Редактировать блок"})}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 z-10 flex justify-end bg-background/95 py-2 backdrop-blur-sm",children:e.jsx(v,{type:"submit",size:"sm",children:"Сохранить"})}),h(),e.jsxs(_,{className:"sticky bottom-0 bg-background pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Отмена"}),e.jsx(v,{type:"submit",children:"Сохранить"})]})]})]})})},$e=()=>`b-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,He=({blocks:t,onChange:r,mediaItems:l})=>{const[u,s]=x.useState(null),[c,d]=x.useState(!1),[m,i]=x.useState("text"),[h,n]=x.useState(!1),[p,y]=x.useState(null),g=(a,o)=>{const b=[...t],O=a+o;O<0||O>=b.length||([b[a],b[O]]=[b[O],b[a]],r(b))},w=a=>{r(t.map(o=>o.id===a?{...o,visible:!o.visible}:o))},C=a=>{s(a),d(!0)},k=a=>{u&&(r(t.map(o=>o.id===u.id?{...o,data:a}:o)),d(!1),s(null))},j=()=>{const a={hero:{title:"",subtitle:""},text:{markdown:""},cta:{title:"",markdown:"",ctaLabel:"",ctaLink:""},services:{title:"Услуги",subtitle:""},portfolio:{title:"Портфолио",subtitle:""},contacts:{title:"Контакты",subtitle:""},custom:{markdown:""}},o={id:$e(),type:m,visible:!0,data:a[m]};r([...t,o]),n(!1)},N=a=>{y(a)},f=()=>{p&&(r(t.filter(a=>a.id!==p.id)),y(null))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Блоки"}),e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:()=>n(!0),children:[e.jsx(K,{className:"mr-1 h-4 w-4"}),"Добавить"]})]}),e.jsx(Ie,{axis:"y",values:t,onReorder:r,className:"space-y-2",children:e.jsx(Y,{children:t.map((a,o)=>{var b;return e.jsxs(ze,{value:a,className:"flex items-center gap-2 rounded-lg border bg-card p-3",children:[e.jsx("div",{className:"flex cursor-grab touch-none items-center text-muted-foreground",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium truncate",children:[W[a.type],((b=a.data)==null?void 0:b.title)&&` — ${String(a.data.title)}`]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.visible?"Видим":"Скрыт"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>w(a.id),title:a.visible?"Скрыть":"Показать",children:a.visible?e.jsx(ke,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(v,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>g(o,-1),disabled:o===0,children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(v,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>g(o,1),disabled:o===t.length-1,children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(v,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>C(a),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(v,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>N(a),children:e.jsx(me,{className:"h-4 w-4"})})]})]},a.id)})})}),e.jsx(Ve,{open:c,onOpenChange:d,block:u,mediaItems:l,onSave:k}),e.jsx(F,{open:h,onOpenChange:n,children:e.jsxs(T,{children:[e.jsx(A,{children:e.jsx(R,{children:"Добавить блок"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Тип блока"}),e.jsxs(he,{value:m,onValueChange:a=>i(a),children:[e.jsx(xe,{children:e.jsx(fe,{})}),e.jsx(pe,{children:Object.entries(W).map(([a,o])=>e.jsx(je,{value:a,children:o},a))})]})]}),e.jsx(v,{onClick:j,children:"Добавить"})]})]})}),e.jsx(Se,{open:!!p,onOpenChange:a=>!a&&y(null),title:"Удалить блок?",description:"Блок будет удалён со страницы.",confirmLabel:"Удалить",variant:"destructive",onConfirm:f})]})},We=()=>`page-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,G=t=>t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""),at=()=>{const[t,r]=x.useState([]),[l,u]=x.useState([]),[s,c]=x.useState(null),[d,m]=x.useState(!1),[i,h]=x.useState(!1),[n,p]=x.useState(""),[y,g]=x.useState("");x.useEffect(()=>{r(ne()),u(ae())},[]);const w=x.useCallback(f=>{r(f),re(f)},[]),C=f=>{c(f),m(!0)},k=f=>{if(!s)return;const a=new Date().toISOString();w(t.map(o=>o.id===s.id?{...o,blocks:f,updatedAt:a}:o)),c(o=>o?{...o,blocks:f,updatedAt:a}:null)},j=()=>{const f=y.trim()||G(n)||"page",a=new Date().toISOString(),o={id:We(),slug:f,title:n.trim()||"Новая страница",blocks:[],updatedAt:a};w([...t,o]),h(!1),p(""),g(""),c(o),m(!0)},N=Ne(l);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Страницы"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Управление контентом страниц: блоки, порядок, видимость"})]}),e.jsxs(v,{onClick:()=>h(!0),className:"w-fit",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Новая страница"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.jsx(Y,{mode:"popLayout",children:t.map(f=>e.jsx(Pe,{page:f,onEdit:C},f.id))})}),e.jsx(F,{open:d,onOpenChange:m,children:e.jsxs(T,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsx(A,{children:e.jsx(R,{children:(s==null?void 0:s.title)??"Редактирование"})}),s&&e.jsx(He,{blocks:s.blocks,onChange:k,mediaItems:N})]})}),e.jsx(F,{open:i,onOpenChange:h,children:e.jsxs(T,{children:[e.jsx(A,{children:e.jsx(R,{children:"Новая страница"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"newTitle",children:"Название"}),e.jsx(E,{id:"newTitle",value:n,onChange:f=>{p(f.target.value),y||g(G(f.target.value))},placeholder:"О нас"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"newSlug",children:"Slug (URL)"}),e.jsx(E,{id:"newSlug",value:y,onChange:f=>g(f.target.value),placeholder:"about"})]})]}),e.jsxs(_,{children:[e.jsx(v,{variant:"outline",onClick:()=>h(!1),children:"Отмена"}),e.jsx(v,{onClick:j,disabled:!n.trim()&&!y.trim(),children:"Создать"})]})]})})]})};export{at as default};
