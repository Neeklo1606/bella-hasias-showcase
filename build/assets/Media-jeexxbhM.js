import{c as U,r as a,j as e,b as V,B as y,A as z,m as G,t as g}from"./index-C5uESbrG.js";import{I as T,D as O,a as B,b as H,c as W,L as I,e as _}from"./label-DElv73vA.js";import{S as D,a as S,b as k,c as A,d as N,P as $,T as q,A as J,e as Y,f as K,g as Q,h as X,i as Z,j as ee,k as te}from"./alert-dialog-CxeugDLC.js";import{S as ae}from"./index-B_gyHhaM.js";import{C as se,b as re,d as le,m as v}from"./media.api-DvV1X37Q.js";import{u as ne}from"./use-resolved-media-DwBaVLrI.js";import"./check-B6GKJrpg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=U("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),E=["Услуги","Кейсы","Баннеры","Главная страница","Прочее"],oe="image/jpeg,image/png,image/webp,video/mp4,video/webm",ce=({onFilesSelected:t,disabled:o})=>{const r=a.useRef(null),[h,s]=a.useState(!1),d=a.useCallback(l=>{if(!(l!=null&&l.length))return;const j=Array.from(l).filter(m=>{var b;const w="."+((b=m.name.split(".").pop())==null?void 0:b.toLowerCase());return[".jpg",".jpeg",".png",".webp",".mp4",".webm"].includes(w)});j.length&&t(j)},[t]),p=a.useCallback(l=>{l.preventDefault(),s(!1),!o&&d(l.dataTransfer.files)},[d,o]),u=a.useCallback(l=>{l.preventDefault(),s(!0)},[]),f=a.useCallback(l=>{l.preventDefault(),l.currentTarget.contains(l.relatedTarget)||s(!1)},[]),c=()=>{var l;o||(l=r.current)==null||l.click()};return e.jsxs("div",{onDrop:p,onDragOver:u,onDragLeave:f,onClick:c,className:V("relative flex min-h-[140px] cursor-pointer flex-col items-center justify-center gap-2 rounded-xl border-2 border-dashed p-6 transition-colors","hover:border-primary/50 hover:bg-muted/50",h&&"border-primary bg-primary/5",o&&"cursor-not-allowed opacity-50"),children:[e.jsx("input",{ref:r,type:"file",multiple:!0,accept:oe,className:"sr-only",onChange:l=>{d(l.target.files),l.target.value=""}}),e.jsx("div",{className:"rounded-full bg-muted p-3",children:e.jsx(ie,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("p",{className:"text-center text-sm font-medium text-foreground",children:"Перетащите файлы сюда или нажмите для выбора"}),e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:"JPG, PNG, WebP, MP4, WebM"})]})},de=({search:t,onSearchChange:o,category:r,onCategoryChange:h})=>e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(T,{placeholder:"Поиск по имени, alt...",value:t,onChange:s=>o(s.target.value),className:"pl-9"})]}),e.jsxs(D,{value:r,onValueChange:h,children:[e.jsx(S,{className:"w-full sm:w-[200px]",children:e.jsx(k,{placeholder:"Категория"})}),e.jsxs(A,{children:[e.jsx(N,{value:"all",children:"Все категории"}),E.map(s=>e.jsx(N,{value:s,children:s},s))]})]})]}),ue=t=>/\.(mp4|webm)$/i.test(t)||t.startsWith("data:video/"),me=({item:t,onEdit:o,onDelete:r,onCategoryChange:h})=>{const[s,d]=a.useState(!1),p=()=>{r(t.id),d(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{className:"group overflow-hidden transition-shadow hover:shadow-md",children:[e.jsx(re,{className:"p-0",children:e.jsx("div",{className:"relative aspect-square bg-muted",children:ue(t.src)?e.jsx("video",{src:t.src,className:"h-full w-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata"}):e.jsx("img",{src:t.src,alt:t.alt,className:"h-full w-full object-cover transition-transform group-hover:scale-105"})})}),e.jsxs(le,{className:"flex flex-col gap-3 border-t p-3",children:[e.jsx("p",{className:"line-clamp-2 text-sm font-medium",title:t.alt||t.filename,children:t.alt||t.filename}),e.jsxs(D,{value:t.category,onValueChange:u=>h(t.id,u),children:[e.jsx(S,{className:"h-8 text-xs",children:e.jsx(k,{})}),e.jsx(A,{children:E.map(u=>e.jsx(N,{value:u,children:u},u))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>o(t),children:[e.jsx($,{className:"mr-1 h-3 w-3"}),"Редактировать"]}),e.jsx(y,{variant:"outline",size:"sm",className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>d(!0),children:e.jsx(q,{className:"h-3 w-3"})})]})]})]}),e.jsx(J,{open:s,onOpenChange:d,children:e.jsxs(Y,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Удалить медиа?"}),e.jsxs(X,{children:["Файл «",t.filename,"» будет удалён из медиатеки. Продолжить?"]})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:"Отмена"}),e.jsx(te,{onClick:p,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})})]})},xe=({items:t,onEdit:o,onDelete:r,onCategoryChange:h})=>e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",children:e.jsx(z,{mode:"popLayout",children:t.map((s,d)=>e.jsx(G.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.2,delay:d*.02},layout:!0,children:e.jsx(me,{item:s,onEdit:o,onDelete:r,onCategoryChange:h})},s.id))})}),he=({open:t,onOpenChange:o,item:r,onSave:h})=>{const[s,d]=a.useState(""),[p,u]=a.useState("Прочее");if(a.useEffect(()=>{r&&(d(r.alt),u(r.category))},[r]),!r)return null;const f=c=>{c.preventDefault(),h(r.id,{alt:s.trim()||r.alt,category:p}),o(!1)};return e.jsx(O,{open:t,onOpenChange:o,children:e.jsxs(B,{className:"sm:max-w-[425px]",children:[e.jsx(H,{children:e.jsx(W,{children:"Редактировать медиа"})}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 z-10 flex justify-end bg-background/95 py-2 backdrop-blur-sm",children:e.jsx(y,{type:"submit",size:"sm",children:"Сохранить"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"alt",children:"Alt-текст"}),e.jsx(T,{id:"alt",value:s,onChange:c=>d(c.target.value),placeholder:"Описание изображения"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"category",children:"Категория"}),e.jsxs(D,{value:p,onValueChange:c=>u(c),children:[e.jsx(S,{id:"category",children:e.jsx(k,{})}),e.jsx(A,{children:E.map(c=>e.jsx(N,{value:c,children:c},c))})]})]}),e.jsxs(_,{className:"sticky bottom-0 bg-background pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Отмена"}),e.jsx(y,{type:"submit",children:"Сохранить"})]})]})]})})},Ce=()=>{const[t,o]=a.useState([]),[r,h]=a.useState(""),[s,d]=a.useState("all"),[p,u]=a.useState(null),[f,c]=a.useState(!1),[l,j]=a.useState(!0),m=a.useCallback(async()=>{try{j(!0);const n=await v.adminList({per_page:100});o(n.data)}catch(n){console.error("Failed to load media:",n),g({title:"Ошибка",description:"Не удалось загрузить медиа-файлы.",variant:"destructive"})}finally{j(!1)}},[]);a.useEffect(()=>{m()},[m]);const w=a.useCallback(async n=>{try{const x=n.map(i=>v.adminUpload({file:i,category:"Прочее",alt:i.name.replace(/\.[^.]+$/,"")}));await Promise.all(x),g({title:"Успешно",description:`Загружено ${n.length} файл(ов).`}),await m()}catch(x){console.error("Failed to upload files:",x),g({title:"Ошибка",description:"Не удалось загрузить файлы.",variant:"destructive"})}},[m]),b=a.useCallback(n=>{u(n),c(!0)},[]),L=a.useCallback(async(n,x)=>{try{await v.adminUpdate(Number(n),{alt:x.alt,category:x.category}),c(!1),u(null),await m(),g({title:"Сохранено",description:"Медиа-файл обновлён."})}catch(i){console.error("Failed to update media:",i),g({title:"Ошибка",description:"Не удалось обновить медиа-файл.",variant:"destructive"})}},[m]),P=a.useCallback(async n=>{try{await v.adminDelete(Number(n)),await m(),g({title:"Удалено",description:"Медиа-файл удалён."})}catch(x){console.error("Failed to delete media:",x),g({title:"Ошибка",description:"Не удалось удалить медиа-файл.",variant:"destructive"})}},[m]),R=a.useCallback(async(n,x)=>{try{await v.adminUpdate(Number(n),{category:x}),await m()}catch(i){console.error("Failed to update category:",i),g({title:"Ошибка",description:"Не удалось обновить категорию.",variant:"destructive"})}},[m]),F=ne(t),M=a.useMemo(()=>{let n=t;if(r.trim()){const i=r.trim().toLowerCase();n=n.filter(C=>C.filename.toLowerCase().includes(i)||C.alt.toLowerCase().includes(i))}s!=="all"&&(n=n.filter(i=>i.category===s));const x=new Map(F.map(i=>[i.id,i]));return[...n].map(i=>x.get(i.id)??i).sort((i,C)=>new Date(C.createdAt).getTime()-new Date(i.createdAt).getTime())},[t,F,r,s]);return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Загрузка..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Медиа"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Загрузка и управление изображениями и видео"})]})}),e.jsx(ce,{onFilesSelected:w}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Файлы загружаются на сервер и сохраняются в базе данных."}),e.jsx(de,{search:r,onSearchChange:h,category:s,onCategoryChange:d}),e.jsx(xe,{items:M,onEdit:b,onDelete:P,onCategoryChange:R}),M.length===0&&e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:t.length===0?"Нет медиа. Загрузите файлы выше.":"Нет результатов по фильтру."}),e.jsx(he,{open:f,onOpenChange:c,item:p,onSave:L})]})};export{Ce as default};
