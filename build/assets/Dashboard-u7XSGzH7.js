import{c as u,j as e,b as C,L as g,a as D,r as c,B as L,s as S,d as T,m as I}from"./index-BjXmukMB.js";import{C as m,a as x,b as h,c as M}from"./card-DKzdbM1M.js";import{I as f}from"./image-CGAlF-Ci.js";import{F as j}from"./file-text-DZhRECcw.js";import{f as E,r as R}from"./ru-CVN3f-jD.js";import{E as B}from"./external-link-BtB53YqC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=u("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=u("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=u("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),o=({title:s,value:i,icon:r,className:t})=>e.jsxs(m,{className:C("overflow-hidden",t),children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:s}),r&&e.jsx("div",{className:"rounded-lg bg-primary/10 p-2",children:e.jsx(r,{className:"h-4 w-4 text-primary"})})]}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold",children:i})})]}),_=s=>/\.(mp4|webm)$/i.test(s)||s.startsWith("data:video/"),G=({items:s,limit:i=4})=>{const r=s.slice(0,i);return e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Последние медиа"}),e.jsx(g,{to:"/admin/media",className:"text-xs text-primary hover:underline",children:"Все медиа"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:r.map(t=>e.jsxs("a",{href:t.src.startsWith("data:")?"#":t.src,target:t.src.startsWith("data:")?void 0:"_blank",rel:"noopener noreferrer",className:"group relative aspect-square overflow-hidden rounded-lg bg-secondary",children:[_(t.src)?e.jsx("video",{src:t.src,className:"h-full w-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata"}):e.jsx("img",{src:t.src,alt:t.alt,className:"h-full w-full object-cover transition-transform group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:e.jsx("p",{className:"truncate text-xs font-medium text-white",children:t.alt||t.filename})})]},t.id))}),s.length===0&&e.jsx("p",{className:"text-center text-sm text-muted-foreground py-6",children:"Нет загруженных медиа"})]})]})},W={service:{label:"Услуга",icon:j},case:{label:"Кейс",icon:b},banner:{label:"Баннер",icon:f}},Z=({items:s,limit:i=6})=>{const r=s.slice(0,i);return e.jsxs(m,{children:[e.jsx(x,{className:"pb-2",children:e.jsx("h3",{className:"text-base font-semibold",children:"Последние изменения"})}),e.jsxs(h,{children:[e.jsx("ul",{className:"space-y-4",children:r.map(t=>{const d=W[t.type],a=d.icon;return e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-md bg-secondary p-2",children:e.jsx(a,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 space-y-0.5 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.label," ·"," ",E(new Date(t.updatedAt),{addSuffix:!0,locale:R})]})]})]},`${t.type}-${t.id}`)})}),s.length===0&&e.jsx("p",{className:"text-center text-sm text-muted-foreground py-6",children:"Нет изменений"})]})]})},$=[{id:"b1",title:"Главный баннер",page:"home",updatedAt:"2025-02-08T09:00:00.000Z"},{id:"b2",title:"Баннер услуг",page:"services",updatedAt:"2025-02-07T13:15:00.000Z"},{id:"b3",title:"Портфолио баннер",page:"portfolio",updatedAt:"2025-02-06T10:30:00.000Z"}],z=()=>{const s=new Date().getHours();return s>=5&&s<12?"Доброе утро":s>=12&&s<18?"Добрый день":"Добрый вечер"},H=(s,i)=>{const r=s.map(a=>({id:String(a.id),type:"service",title:a.title,updatedAt:a.updatedAt})),t=i.map(a=>({id:String(a.id),type:"case",title:a.title,updatedAt:a.updatedAt})),d=$.map(a=>({id:a.id,type:"banner",title:a.title,updatedAt:a.updatedAt}));return[...r,...t,...d].sort((a,n)=>new Date(n.updatedAt).getTime()-new Date(a.updatedAt).getTime())},X=()=>{const{user:s}=D(),i=z(),[r,t]=c.useState([]),[d,a]=c.useState([]),[n,y]=c.useState([]),[N,v]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const[p,A,k]=await Promise.all([S.adminList({per_page:100}),T.adminList({per_page:100}),I.adminList({per_page:100})]);t(p.data.map(l=>({id:Number(l.id),title:l.title,updatedAt:l.updatedAt}))),a(A.data.map(l=>({id:Number(l.id),title:l.title,updatedAt:l.updatedAt}))),y(k.data)}catch(p){console.error("Failed to load dashboard data:",p)}finally{v(!1)}})()},[]);const w=H(r,d);return N?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Загрузка..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Панель управления"}),e.jsxs("p",{className:"mt-1 text-muted-foreground",children:[i,", ",(s==null?void 0:s.name)??"Пользователь"]})]}),e.jsx(L,{asChild:!0,variant:"outline",size:"sm",className:"w-fit",children:e.jsxs(g,{to:"/",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Перейти на сайт"]})})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(o,{title:"Услуги",value:r.length,icon:j}),e.jsx(o,{title:"Кейсы",value:d.length,icon:b}),e.jsx(o,{title:"Заявки",value:"—",icon:V}),e.jsx(o,{title:"Медиа-файлы",value:n.length,icon:f})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(m,{className:"lg:col-span-2",children:[e.jsx(x,{children:e.jsxs(M,{className:"flex items-center gap-2 text-base font-semibold",children:[e.jsx(F,{className:"h-4 w-4"}),"Просмотры сайта за последние 7 дней"]})}),e.jsx(h,{children:e.jsx("div",{className:"flex aspect-video items-center justify-center rounded-lg border border-dashed border-border bg-muted/30",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"График (заглушка)"})})})]}),e.jsx(Z,{items:w,limit:6})]}),e.jsx(G,{items:n,limit:4})]})};export{X as default};
