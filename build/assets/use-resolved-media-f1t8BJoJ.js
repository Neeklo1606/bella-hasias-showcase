import{r as c}from"./index-k3DuJ_tz.js";const w="bella_media_files",i="files",E=1,j=()=>new Promise((t,e)=>{if(!("indexedDB"in window)){e(new Error("IndexedDB is not available"));return}const s=indexedDB.open(w,E);s.onerror=()=>e(s.error),s.onupgradeneeded=()=>{const n=s.result;n.objectStoreNames.contains(i)||n.createObjectStore(i)},s.onsuccess=()=>t(s.result)}),l=async(t,e)=>{const s=await j();return new Promise((n,r)=>{const u=s.transaction(i,t).objectStore(i),o=e(u);o.onerror=()=>r(o.error),o.onsuccess=()=>n(o.result)})},x=async(t,e)=>{await l("readwrite",s=>s.put(e,t))},p=async t=>l("readonly",e=>e.get(t)),y=async t=>{await l("readwrite",e=>e.delete(t))},M=t=>t.startsWith("idb://"),R=t=>t.replace("idb://",""),O=t=>{const[e,s]=c.useState({}),n=c.useRef(e);return c.useEffect(()=>{n.current=e},[e]),c.useEffect(()=>{let r=!1;const d=t.filter(o=>M(o.src)&&!e[o.id]);return d.length?((async()=>{const o={};for(const a of d)try{const f=R(a.src),b=await p(f);if(!b)continue;o[a.id]=URL.createObjectURL(b)}catch{}!r&&Object.keys(o).length>0&&s(a=>({...a,...o}))})(),()=>{r=!0}):void 0},[t,e]),c.useEffect(()=>()=>{Object.values(n.current).forEach(r=>{URL.revokeObjectURL(r)})},[]),c.useMemo(()=>t.map(r=>e[r.id]?{...r,src:e[r.id]}:r),[t,e])};export{y as d,R as g,M as i,x as s,O as u};
