import{r as c}from"./index-B62UnXnU.js";const f="bella_media_files",i="files",E=1,j=()=>new Promise((t,e)=>{if(!("indexedDB"in window)){e(new Error("IndexedDB is not available"));return}const o=indexedDB.open(f,E);o.onerror=()=>e(o.error),o.onupgradeneeded=()=>{const n=o.result;n.objectStoreNames.contains(i)||n.createObjectStore(i)},o.onsuccess=()=>t(o.result)}),R=async(t,e)=>{const o=await j();return new Promise((n,s)=>{const l=o.transaction(i,t).objectStore(i),r=e(l);r.onerror=()=>s(r.error),r.onsuccess=()=>n(r.result)})},p=async t=>R("readonly",e=>e.get(t)),w=t=>t.startsWith("idb://"),x=t=>t.replace("idb://",""),g=t=>{const[e,o]=c.useState({}),n=c.useRef(e);return c.useEffect(()=>{n.current=e},[e]),c.useEffect(()=>{let s=!1;const d=t.filter(r=>w(r.src)&&!e[r.id]);return d.length?((async()=>{const r={};for(const a of d)try{const b=x(a.src),u=await p(b);if(!u)continue;r[a.id]=URL.createObjectURL(u)}catch{}!s&&Object.keys(r).length>0&&o(a=>({...a,...r}))})(),()=>{s=!0}):void 0},[t,e]),c.useEffect(()=>()=>{Object.values(n.current).forEach(s=>{URL.revokeObjectURL(s)})},[]),c.useMemo(()=>t.map(s=>e[s.id]?{...s,src:e[s.id]}:s),[t,e])};export{g as u};
