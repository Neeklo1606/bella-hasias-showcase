import{c as R,r as o,j as e,b as W,B as v,A as B,e as H,f as $,g as J,h as D,m as f}from"./index-Da8R1Z61.js";import{u as C}from"./useMutation-CDt2vLN2.js";import{I,D as Y,a as X,b as Z,c as ee,e as ae}from"./input-BTvI3psF.js";import{S,a as w,b as P,c as k,d as N,P as te}from"./Pagination-DjkxDt4R.js";import{S as se,L as re}from"./index-BDzbB6h7.js";import{C as le,b as ne,d as oe}from"./card-dk8wfevT.js";import{P as ie,T as ce,A as de,a as ue,b as me,c as xe,d as ge,e as he,f as pe,g as je}from"./alert-dialog-1ZtB3lJG.js";import{L as F}from"./label-w4nlHq8T.js";import{u as fe}from"./use-resolved-media-BXHrw9xP.js";import"./check-Cj8ik3qq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=R("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),A=["Услуги","Кейсы","Баннеры","Главная страница","Прочее"],ye="image/jpeg,image/png,image/webp,video/mp4,video/webm",be=({onFilesSelected:a,disabled:l})=>{const n=o.useRef(null),[c,r]=o.useState(!1),i=o.useCallback(s=>{if(!(s!=null&&s.length))return;const y=Array.from(s).filter(j=>{var g;const b="."+((g=j.name.split(".").pop())==null?void 0:g.toLowerCase());return[".jpg",".jpeg",".png",".webp",".mp4",".webm"].includes(b)});y.length&&a(y)},[a]),x=o.useCallback(s=>{s.preventDefault(),r(!1),!l&&i(s.dataTransfer.files)},[i,l]),u=o.useCallback(s=>{s.preventDefault(),r(!0)},[]),p=o.useCallback(s=>{s.preventDefault(),s.currentTarget.contains(s.relatedTarget)||r(!1)},[]),d=()=>{var s;l||(s=n.current)==null||s.click()};return e.jsxs("div",{onDrop:x,onDragOver:u,onDragLeave:p,onClick:d,className:W("relative flex min-h-[140px] cursor-pointer flex-col items-center justify-center gap-2 rounded-xl border-2 border-dashed p-6 transition-colors","hover:border-primary/50 hover:bg-muted/50",c&&"border-primary bg-primary/5",l&&"cursor-not-allowed opacity-50"),children:[e.jsx("input",{ref:n,type:"file",multiple:!0,accept:ye,className:"sr-only",onChange:s=>{i(s.target.files),s.target.value=""}}),e.jsx("div",{className:"rounded-full bg-muted p-3",children:e.jsx(ve,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("p",{className:"text-center text-sm font-medium text-foreground",children:"Перетащите файлы сюда или нажмите для выбора"}),e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:"JPG, PNG, WebP, MP4, WebM"})]})},Ce=({search:a,onSearchChange:l,category:n,onCategoryChange:c})=>e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(I,{placeholder:"Поиск по имени, alt...",value:a,onChange:r=>l(r.target.value),className:"pl-9"})]}),e.jsxs(S,{value:n,onValueChange:c,children:[e.jsx(w,{className:"w-full sm:w-[200px]",children:e.jsx(P,{placeholder:"Категория"})}),e.jsxs(k,{children:[e.jsx(N,{value:"all",children:"Все категории"}),A.map(r=>e.jsx(N,{value:r,children:r},r))]})]})]}),Ne=a=>/\.(mp4|webm)$/i.test(a)||a.startsWith("data:video/"),De=({item:a,onEdit:l,onDelete:n,onCategoryChange:c})=>{const[r,i]=o.useState(!1),x=()=>{n(a.id),i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(le,{className:"group overflow-hidden transition-shadow hover:shadow-md",children:[e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"relative aspect-square bg-muted",children:Ne(a.src)?e.jsx("video",{src:a.src,className:"h-full w-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata"}):e.jsx("img",{src:a.src,alt:a.alt,className:"h-full w-full object-cover transition-transform group-hover:scale-105"})})}),e.jsxs(oe,{className:"flex flex-col gap-3 border-t p-3",children:[e.jsx("p",{className:"line-clamp-2 text-sm font-medium",title:a.alt||a.filename,children:a.alt||a.filename}),e.jsxs(S,{value:a.category,onValueChange:u=>c(a.id,u),children:[e.jsx(w,{className:"h-8 text-xs",children:e.jsx(P,{})}),e.jsx(k,{children:A.map(u=>e.jsx(N,{value:u,children:u},u))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>l(a),children:[e.jsx(ie,{className:"mr-1 h-3 w-3"}),"Редактировать"]}),e.jsx(v,{variant:"outline",size:"sm",className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>i(!0),children:e.jsx(ce,{className:"h-3 w-3"})})]})]})]}),e.jsx(de,{open:r,onOpenChange:i,children:e.jsxs(ue,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Удалить медиа?"}),e.jsxs(ge,{children:["Файл «",a.filename,"» будет удалён из медиатеки. Продолжить?"]})]}),e.jsxs(he,{children:[e.jsx(pe,{children:"Отмена"}),e.jsx(je,{onClick:x,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})})]})},Se=({items:a,onEdit:l,onDelete:n,onCategoryChange:c})=>e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",children:e.jsx(B,{mode:"popLayout",children:a.map((r,i)=>e.jsx(H.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.2,delay:i*.02},layout:!0,children:e.jsx(De,{item:r,onEdit:l,onDelete:n,onCategoryChange:c})},r.id))})}),we=({open:a,onOpenChange:l,item:n,onSave:c})=>{const[r,i]=o.useState(""),[x,u]=o.useState("Прочее");if(o.useEffect(()=>{n&&(i(n.alt),u(n.category))},[n]),!n)return null;const p=d=>{d.preventDefault(),c(n.id,{alt:r.trim()||n.alt,category:x}),l(!1)};return e.jsx(Y,{open:a,onOpenChange:l,children:e.jsxs(X,{className:"sm:max-w-[425px]",children:[e.jsx(Z,{children:e.jsx(ee,{children:"Редактировать медиа"})}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 z-10 flex justify-end bg-background/95 py-2 backdrop-blur-sm",children:e.jsx(v,{type:"submit",size:"sm",children:"Сохранить"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"alt",children:"Alt-текст"}),e.jsx(I,{id:"alt",value:r,onChange:d=>i(d.target.value),placeholder:"Описание изображения"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"category",children:"Категория"}),e.jsxs(S,{value:x,onValueChange:d=>u(d),children:[e.jsx(w,{id:"category",children:e.jsx(P,{})}),e.jsx(k,{children:A.map(d=>e.jsx(N,{value:d,children:d},d))})]})]}),e.jsxs(ae,{className:"sticky bottom-0 bg-background pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Отмена"}),e.jsx(v,{type:"submit",children:"Сохранить"})]})]})]})})},Qe=()=>{const a=$(),[l,n]=o.useState(""),[c,r]=o.useState("all"),[i,x]=o.useState(1),[u,p]=o.useState(25),[d,s]=o.useState(null),[y,j]=o.useState(!1),b={per_page:u,page:i,...l.trim()&&{q:l.trim()},...c!=="all"&&{category:c}},{data:g,isLoading:T}=J({queryKey:["media","admin",b],queryFn:()=>f.adminList(b),refetchOnWindowFocus:!1,retry:1}),L=(g==null?void 0:g.data)||[],M=T,h=g?{currentPage:g.current_page,lastPage:g.last_page,perPage:g.per_page,total:g.total}:null,q=C({mutationFn:t=>Promise.all(t.map(m=>f.adminUpload({file:m,category:"Прочее",alt:m.name.replace(/\.[^.]+$/,"")}))),onSuccess:(t,m)=>{a.invalidateQueries({queryKey:["media","admin"]}),D.success(`Загружено ${m.length} файл(ов)`)}}),_=C({mutationFn:({id:t,data:m})=>f.adminUpdate(t,m),onSuccess:()=>{a.invalidateQueries({queryKey:["media","admin"]}),D.success("Медиа-файл обновлён"),j(!1),s(null)}}),Q=C({mutationFn:t=>f.adminDelete(t),onSuccess:()=>{a.invalidateQueries({queryKey:["media","admin"]}),D.success("Медиа-файл удалён")}}),U=C({mutationFn:({id:t,category:m})=>f.adminUpdate(t,{category:m}),onSuccess:()=>{a.invalidateQueries({queryKey:["media","admin"]})}}),K=t=>{q.mutate(t)},O=t=>{s(t),j(!0)},V=(t,m)=>{_.mutate({id:Number(t),data:m})},z=t=>{Q.mutate(Number(t))},G=(t,m)=>{U.mutate({id:Number(t),category:m})},E=fe(L);return M?e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx(re,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("div",{className:"text-sm text-muted-foreground ml-3",children:"Загрузка медиа..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Медиа"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Загрузка и управление изображениями и видео"})]})}),e.jsx(be,{onFilesSelected:K}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Файлы загружаются на сервер и сохраняются в базе данных."}),e.jsx(Ce,{search:l,onSearchChange:t=>{n(t),x(1)},category:c,onCategoryChange:t=>{r(t),x(1)}}),e.jsx(Se,{items:E,onEdit:O,onDelete:z,onCategoryChange:G}),E.length===0&&!M&&e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:(h==null?void 0:h.total)===0?"Нет медиа. Загрузите файлы выше.":"Нет результатов по фильтру."}),h&&e.jsx(te,{currentPage:h.currentPage,lastPage:h.lastPage,perPage:h.perPage,total:h.total,onPageChange:t=>{x(t),window.scrollTo({top:0,behavior:"smooth"})},onPerPageChange:t=>{p(t),x(1)}}),e.jsx(we,{open:y,onOpenChange:j,item:d,onSave:V})]})};export{Qe as default};
