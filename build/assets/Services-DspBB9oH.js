import{j as e,m as z,B as g,r as o,A as B}from"./index-C5uESbrG.js";import{D as O,a as V,b as _,c as q,L as x,I as y,e as G}from"./label-DElv73vA.js";import{C as H,b as U,d as W,m as $}from"./media.api-DvV1X37Q.js";import{B as L,T as J}from"./TagsInput-BNMbW1A_.js";import{I as K}from"./image-CTmPK9n4.js";import{P as Q,T as X,S as Y,a as Z,b as ee,c as te,d as se}from"./alert-dialog-CxeugDLC.js";import{f as ae,r as le}from"./ru-CVN3f-jD.js";import{T as ie}from"./popover-BMJZbY8k.js";import{M as S}from"./MediaSelect-BTtvT2QE.js";import{P as re,C as ce}from"./ConfirmDialog-C7a5Q5UN.js";import{s as v}from"./services.api-dcAbJovg.js";import{u as oe}from"./use-resolved-media-DwBaVLrI.js";import{S as ne}from"./index-B_gyHhaM.js";import"./check-B6GKJrpg.js";const de=({service:l,mediaMap:u,onEdit:c,onDelete:n})=>{const d=u.get(l.imageId),i=l.category==="stylist"?"Стилист":l.category==="creator"?"Креатор":l.category;return e.jsx(z.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.2},layout:!0,children:e.jsxs(H,{className:"group overflow-hidden transition-shadow hover:shadow-md",children:[e.jsx(U,{className:"p-0",children:e.jsx("div",{className:"relative aspect-[4/3] bg-muted",children:d&&!d.src.startsWith("data:video")?e.jsx("img",{src:d.src,alt:l.title,className:"h-full w-full object-cover transition-transform group-hover:scale-105"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(K,{className:"h-12 w-12 text-muted-foreground/50"})})})}),e.jsxs(W,{className:"flex flex-col items-start gap-3 border-t p-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"font-semibold truncate",children:l.title}),i&&e.jsx("div",{className:"mt-1.5",children:e.jsx(L,{variant:"outline",className:"text-xs",children:i})}),l.tags.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1",children:l.tags.slice(0,3).map(r=>e.jsx(L,{variant:"secondary",className:"text-xs",children:r},r))}),e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["Обновлено:"," ",ae(new Date(l.updatedAt),{addSuffix:!0,locale:le})]})]}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>c(l),children:[e.jsx(Q,{className:"mr-1 h-3 w-3"}),"Редактировать"]}),e.jsx(g,{variant:"outline",size:"sm",className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>n(l),children:e.jsx(X,{className:"h-3 w-3"})})]})]})]})})},me=[{value:"stylist",label:"Стилист"},{value:"creator",label:"Креатор"}],k={title:"",description:"",category:"stylist",imageId:"",tags:[],ctaLabel:"",ctaLink:""},ue=({open:l,onOpenChange:u,service:c,mediaItems:n,onSubmit:d})=>{const[i,r]=o.useState(k);o.useEffect(()=>{var s;r(c?{title:c.title,description:c.description,category:c.category,imageId:c.imageId,coverId:c.coverId,tags:c.tags??[],ctaLabel:c.ctaLabel,ctaLink:c.ctaLink}:{...k,imageId:((s=n[0])==null?void 0:s.id)??""})},[c,n,l]);const h=s=>{s.preventDefault(),i.title.trim()&&(!i.imageId&&n.length>0&&r(a=>({...a,imageId:n[0].id})),d(i),u(!1))};return e.jsx(O,{open:l,onOpenChange:u,children:e.jsxs(V,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[600px]",children:[e.jsx(_,{children:e.jsx(q,{children:c?"Редактировать услугу":"Новая услуга"})}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 z-10 flex justify-end bg-background/95 py-2 backdrop-blur-sm",children:e.jsx(g,{type:"submit",size:"sm",children:"Сохранить"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"title",children:"Заголовок *"}),e.jsx(y,{id:"title",value:i.title,onChange:s=>r(a=>({...a,title:s.target.value})),placeholder:"Название услуги",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"description",children:"Описание (Markdown)"}),e.jsx(ie,{id:"description",value:i.description,onChange:s=>r(a=>({...a,description:s.target.value})),placeholder:"Описание услуги. Поддерживается Markdown.",rows:4,className:"resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"category",children:"Категория"}),e.jsxs(Y,{value:i.category??"stylist",onValueChange:s=>r(a=>({...a,category:s})),children:[e.jsx(Z,{id:"category",children:e.jsx(ee,{placeholder:"Выберите категорию"})}),e.jsx(te,{children:me.map(s=>e.jsx(se,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Теги"}),e.jsx(J,{value:i.tags,onChange:s=>r(a=>({...a,tags:s}))})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(S,{label:"Превью (imageId)",value:i.imageId,onChange:s=>r(a=>({...a,imageId:s})),items:n,placeholder:"Выберите изображение"}),e.jsx(S,{label:"Обложка (опционально)",value:i.coverId??"",onChange:s=>r(a=>({...a,coverId:s||void 0})),items:n,placeholder:"Без обложки",allowEmpty:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"ctaLabel",children:"CTA — Подпись кнопки"}),e.jsx(y,{id:"ctaLabel",value:i.ctaLabel,onChange:s=>r(a=>({...a,ctaLabel:s.target.value})),placeholder:"Записаться"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"ctaLink",children:"CTA — Ссылка"}),e.jsx(y,{id:"ctaLink",value:i.ctaLink,onChange:s=>r(a=>({...a,ctaLink:s.target.value})),placeholder:"/services/stylist"})]}),e.jsxs(G,{className:"sticky bottom-0 bg-background pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Отмена"}),e.jsx(g,{type:"submit",children:"Сохранить"})]})]})]})})},Se=()=>{const[l,u]=o.useState([]),[c,n]=o.useState([]),[d,i]=o.useState(""),[r,h]=o.useState(!1),[s,a]=o.useState(null),[p,b]=o.useState(null),[D,w]=o.useState(!0),f=o.useCallback(async()=>{try{w(!0);const[t,m]=await Promise.all([v.adminList({per_page:100}),$.adminList({per_page:100})]);u(t.data),n(m.data)}catch(t){console.error("Failed to load services:",t)}finally{w(!1)}},[]);o.useEffect(()=>{f()},[f]);const N=oe(c),T=o.useMemo(()=>new Map(N.map(t=>[t.id,t])),[N]),F=()=>{a(null),h(!0)},E=t=>{a(t),h(!0)},M=async t=>{try{s?await v.adminUpdate(Number(s.id),{title:t.title,description:t.description,category:t.category,imageId:t.imageId?Number(t.imageId):void 0,coverId:t.coverId?Number(t.coverId):void 0,tags:t.tags||[],ctaLabel:t.ctaLabel,ctaLink:t.ctaLink,status:t.status||"published"}):await v.adminCreate({title:t.title,description:t.description,category:t.category,imageId:t.imageId?Number(t.imageId):void 0,coverId:t.coverId?Number(t.coverId):void 0,tags:t.tags||[],ctaLabel:t.ctaLabel,ctaLink:t.ctaLink,status:t.status||"published"}),h(!1),a(null),await f()}catch(m){console.error("Failed to save service:",m)}},A=t=>{b(t)},P=async()=>{if(p)try{await v.adminDelete(Number(p.id)),b(null),await f()}catch(t){console.error("Failed to delete service:",t)}},C=o.useMemo(()=>{let t=l;if(d.trim()){const m=d.trim().toLowerCase();t=t.filter(j=>{var I;return j.title.toLowerCase().includes(m)||((I=j.tags)==null?void 0:I.some(R=>R.toLowerCase().includes(m)))})}return[...t].sort((m,j)=>new Date(j.updatedAt).getTime()-new Date(m.updatedAt).getTime())},[l,d]);return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Загрузка..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Услуги"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Управление услугами и связь с медиа"})]}),e.jsxs(g,{onClick:F,className:"w-fit",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Добавить услугу"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(y,{placeholder:"Поиск по заголовку или тегам...",value:d,onChange:t=>i(t.target.value),className:"pl-9 max-w-md"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:e.jsx(B,{mode:"popLayout",children:C.map(t=>e.jsx(de,{service:t,mediaMap:T,onEdit:E,onDelete:A},t.id))})}),C.length===0&&e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:l.length===0?"Нет услуг. Добавьте первую.":"Нет результатов по поиску."}),e.jsx(ue,{open:r,onOpenChange:h,service:s,mediaItems:N,onSubmit:M}),e.jsx(ce,{open:!!p,onOpenChange:t=>!t&&b(null),title:"Удалить услугу?",description:p?`Услуга «${p.title}» будет удалена. Продолжить?`:"",confirmLabel:"Удалить",cancelLabel:"Отмена",variant:"destructive",onConfirm:P})]})};export{Se as default};
