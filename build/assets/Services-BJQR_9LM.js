import{j as e,m as A,B as p,r as c,l as z,A as P}from"./index-k3DuJ_tz.js";import{D as B,a as O,b as R,c as V,L as g,I as f,e as $}from"./label-CafXyzQ-.js";import{C as q,b as G,d as H}from"./card-DK3CJppT.js";import{B as w,T as W}from"./TagsInput-m-O9p99S.js";import{I as _}from"./image-CrTN3bSh.js";import{P as J,T as K,S as Q,a as U,b as X,c as Y,d as Z}from"./alert-dialog-CL3EX-GP.js";import{f as ee,r as te}from"./ru-CVN3f-jD.js";import{T as se}from"./popover-D46gzM3n.js";import{M as S}from"./MediaSelect-D_UDTOXt.js";import{P as ae,C as le}from"./ConfirmDialog-DsqAWvAt.js";import{l as ie,s as re}from"./servicesStorage-BoZ-VFie.js";import{u as oe}from"./use-resolved-media-f1t8BJoJ.js";import{S as ce}from"./index-1uTjpNEu.js";import"./check-B1lSWNHc.js";const ne=({service:a,mediaMap:m,onEdit:o,onDelete:n})=>{const d=m.get(a.imageId),i=a.category==="stylist"?"Стилист":a.category==="creator"?"Креатор":a.category;return e.jsx(A.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{duration:.2},layout:!0,children:e.jsxs(q,{className:"group overflow-hidden transition-shadow hover:shadow-md",children:[e.jsx(G,{className:"p-0",children:e.jsx("div",{className:"relative aspect-[4/3] bg-muted",children:d&&!d.src.startsWith("data:video")?e.jsx("img",{src:d.src,alt:a.title,className:"h-full w-full object-cover transition-transform group-hover:scale-105"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(_,{className:"h-12 w-12 text-muted-foreground/50"})})})}),e.jsxs(H,{className:"flex flex-col items-start gap-3 border-t p-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"font-semibold truncate",children:a.title}),i&&e.jsx("div",{className:"mt-1.5",children:e.jsx(w,{variant:"outline",className:"text-xs",children:i})}),a.tags.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1",children:a.tags.slice(0,3).map(r=>e.jsx(w,{variant:"secondary",className:"text-xs",children:r},r))}),e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["Обновлено:"," ",ee(new Date(a.updatedAt),{addSuffix:!0,locale:te})]})]}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>o(a),children:[e.jsx(J,{className:"mr-1 h-3 w-3"}),"Редактировать"]}),e.jsx(p,{variant:"outline",size:"sm",className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>n(a),children:e.jsx(K,{className:"h-3 w-3"})})]})]})]})})},de=[{value:"stylist",label:"Стилист"},{value:"creator",label:"Креатор"}],I={title:"",description:"",category:"stylist",imageId:"",tags:[],ctaLabel:"",ctaLink:""},me=({open:a,onOpenChange:m,service:o,mediaItems:n,onSubmit:d})=>{const[i,r]=c.useState(I);c.useEffect(()=>{var t;r(o?{title:o.title,description:o.description,category:o.category,imageId:o.imageId,coverId:o.coverId,tags:o.tags??[],ctaLabel:o.ctaLabel,ctaLink:o.ctaLink}:{...I,imageId:((t=n[0])==null?void 0:t.id)??""})},[o,n,a]);const x=t=>{t.preventDefault(),i.title.trim()&&(!i.imageId&&n.length>0&&r(l=>({...l,imageId:n[0].id})),d(i),m(!1))};return e.jsx(B,{open:a,onOpenChange:m,children:e.jsxs(O,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[600px]",children:[e.jsx(R,{children:e.jsx(V,{children:o?"Редактировать услугу":"Новая услуга"})}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 z-10 flex justify-end bg-background/95 py-2 backdrop-blur-sm",children:e.jsx(p,{type:"submit",size:"sm",children:"Сохранить"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"title",children:"Заголовок *"}),e.jsx(f,{id:"title",value:i.title,onChange:t=>r(l=>({...l,title:t.target.value})),placeholder:"Название услуги",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"description",children:"Описание (Markdown)"}),e.jsx(se,{id:"description",value:i.description,onChange:t=>r(l=>({...l,description:t.target.value})),placeholder:"Описание услуги. Поддерживается Markdown.",rows:4,className:"resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"category",children:"Категория"}),e.jsxs(Q,{value:i.category??"stylist",onValueChange:t=>r(l=>({...l,category:t})),children:[e.jsx(U,{id:"category",children:e.jsx(X,{placeholder:"Выберите категорию"})}),e.jsx(Y,{children:de.map(t=>e.jsx(Z,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Теги"}),e.jsx(W,{value:i.tags,onChange:t=>r(l=>({...l,tags:t}))})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(S,{label:"Превью (imageId)",value:i.imageId,onChange:t=>r(l=>({...l,imageId:t})),items:n,placeholder:"Выберите изображение"}),e.jsx(S,{label:"Обложка (опционально)",value:i.coverId??"",onChange:t=>r(l=>({...l,coverId:t||void 0})),items:n,placeholder:"Без обложки",allowEmpty:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"ctaLabel",children:"CTA — Подпись кнопки"}),e.jsx(f,{id:"ctaLabel",value:i.ctaLabel,onChange:t=>r(l=>({...l,ctaLabel:t.target.value})),placeholder:"Записаться"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"ctaLink",children:"CTA — Ссылка"}),e.jsx(f,{id:"ctaLink",value:i.ctaLink,onChange:t=>r(l=>({...l,ctaLink:t.target.value})),placeholder:"/services/stylist"})]}),e.jsxs($,{className:"sticky bottom-0 bg-background pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Отмена"}),e.jsx(p,{type:"submit",children:"Сохранить"})]})]})]})})},ue=()=>`svc-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,Le=()=>{const[a,m]=c.useState([]),[o,n]=c.useState([]),[d,i]=c.useState(""),[r,x]=c.useState(!1),[t,l]=c.useState(null),[j,v]=c.useState(null);c.useEffect(()=>{m(ie()),n(z())},[]);const y=c.useCallback(s=>{m(s),re(s)},[]),N=oe(o),L=c.useMemo(()=>new Map(N.map(s=>[s.id,s])),[N]),k=()=>{l(null),x(!0)},D=s=>{l(s),x(!0)},T=s=>{const h=new Date().toISOString();y(t?a.map(u=>u.id===t.id?{...s,id:u.id,updatedAt:h}:u):[{...s,id:ue(),updatedAt:h},...a]),x(!1),l(null)},M=s=>{v(s)},E=()=>{j&&(y(a.filter(s=>s.id!==j.id)),v(null))},b=c.useMemo(()=>{let s=a;if(d.trim()){const h=d.trim().toLowerCase();s=s.filter(u=>{var C;return u.title.toLowerCase().includes(h)||((C=u.tags)==null?void 0:C.some(F=>F.toLowerCase().includes(h)))})}return[...s].sort((h,u)=>new Date(u.updatedAt).getTime()-new Date(h.updatedAt).getTime())},[a,d]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Услуги"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Управление услугами и связь с медиа"})]}),e.jsxs(p,{onClick:k,className:"w-fit",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Добавить услугу"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(f,{placeholder:"Поиск по заголовку или тегам...",value:d,onChange:s=>i(s.target.value),className:"pl-9 max-w-md"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:e.jsx(P,{mode:"popLayout",children:b.map(s=>e.jsx(ne,{service:s,mediaMap:L,onEdit:D,onDelete:M},s.id))})}),b.length===0&&e.jsx("p",{className:"py-12 text-center text-sm text-muted-foreground",children:a.length===0?"Нет услуг. Добавьте первую.":"Нет результатов по поиску."}),e.jsx(me,{open:r,onOpenChange:x,service:t,mediaItems:N,onSubmit:T}),e.jsx(le,{open:!!j,onOpenChange:s=>!s&&v(null),title:"Удалить услугу?",description:j?`Услуга «${j.title}» будет удалена. Продолжить?`:"",confirmLabel:"Удалить",cancelLabel:"Отмена",variant:"destructive",onConfirm:E})]})};export{Le as default};
